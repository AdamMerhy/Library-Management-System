@model Book
@{
    ViewData["Title"] = $"Delete â€“ {Model.Title}";
    var hasActiveLoans = Model.AvailableCopies < Model.TotalCopies;
}

<div class="form-page">
    <h2 class="fw-bold mb-4">Delete Book</h2>

    @if (hasActiveLoans)
    {
        <div class="alert alert-danger">
            <strong>Cannot delete.</strong>
            This book has <strong>@(Model.TotalCopies - Model.AvailableCopies)</strong> copy/copies currently borrowed.
            All copies must be returned before deletion.
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            Are you sure you want to delete this book? This action cannot be undone.
        </div>
    }

    <div class="card" style="max-width:600px;">
        <div class="card-body p-4 d-flex gap-3">
            @if (!string.IsNullOrWhiteSpace(Model.CoverImageUrl))
            {
                <img src="@Model.CoverImageUrl" alt="@Model.Title"
                     style="width:80px;height:110px;object-fit:cover;border-radius:.5rem;" />
            }
            else
            {
                <div class="loan-card-cover-placeholder" style="width:80px;height:110px;font-size:2rem;">ðŸ“–</div>
            }
            <div>
                <h5 class="fw-bold mb-1">@Model.Title</h5>
                <p class="text-muted mb-1">@Model.Author</p>
                <small class="text-muted">@(Model.ISBN ?? "No ISBN") Â· @(Model.Category ?? "Uncategorised")</small>
                <div class="mt-2">
                    <span class="badge @(hasActiveLoans ? "badge-unavailable" : "badge-available")">
                        @Model.AvailableCopies / @Model.TotalCopies copies
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 d-flex gap-2">
        @if (!hasActiveLoans)
        {
            <form method="post" asp-action="Delete" asp-route-id="@Model.Id" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-danger">Yes, Delete</button>
            </form>
        }
        <a asp-action="Index" class="btn btn-outline-secondary">Cancel</a>
    </div>
</div>