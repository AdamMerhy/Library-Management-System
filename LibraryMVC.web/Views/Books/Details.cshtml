@model Book
@{
    ViewData["Title"] = Model.Title;
    var tags = Model.Tags?.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
}

<div class="row g-4 mt-2">
    <div class="col-md-4 text-center">
        @if (!string.IsNullOrWhiteSpace(Model.CoverImageUrl))
        {
            <img src="@Model.CoverImageUrl" alt="@Model.Title" class="detail-cover" />
        }
        else
        {
            <div class="detail-cover-placeholder mx-auto">üìñ</div>
        }
    </div>
    <div class="col-md-8 detail-info">
        <h2 class="fw-bold mb-1">@Model.Title</h2>
        <p class="text-muted fs-5 mb-3">by @Model.Author</p>

        <div class="d-flex flex-wrap gap-2 mb-3">
            @if (!string.IsNullOrWhiteSpace(Model.Category))
            {
                <span class="badge badge-category">@Model.Category</span>
            }
            @if (tags is { Length: > 0 })
            {
                @foreach (var tag in tags)
                {
                    <span class="badge" style="background:#f1f5f9;color:#475569;">@tag</span>
                }
            }
        </div>

        <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
                <dt>ISBN</dt>
                <dd>@(Model.ISBN ?? "‚Äî")</dd>
            </div>
            <div class="col-6 col-md-3">
                <dt>Language</dt>
                <dd>@(Model.Language ?? "‚Äî")</dd>
            </div>
            <div class="col-6 col-md-3">
                <dt>Year</dt>
                <dd>@(Model.PublishYear?.ToString() ?? "‚Äî")</dd>
            </div>
            <div class="col-6 col-md-3">
                <dt>Shelf</dt>
                <dd>@(Model.LocationShelf ?? "‚Äî")</dd>
            </div>
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.Description))
        {
            <div class="mb-4">
                <dt>Description</dt>
                <dd class="lh-lg">@Model.Description</dd>
            </div>
        }

        <div class="d-flex align-items-center gap-3 mb-4">
            <span class="badge @(Model.AvailableCopies > 0 ? "badge-available" : "badge-unavailable") fs-6 px-3 py-2">
                @Model.AvailableCopies available / @Model.TotalCopies total
            </span>
        </div>

        <div class="d-flex flex-wrap gap-2">
            <a asp-action="Index" class="btn btn-outline-secondary">‚Üê Back</a>

            @if (User.Identity?.IsAuthenticated == true && Model.AvailableCopies > 0)
            {
                <form method="post" asp-action="Borrow" asp-route-id="@Model.Id" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-primary"
                            onclick="return confirm('Borrow this book for 14 days?')">
                        üìñ Borrow This Book
                    </button>
                </form>
            }

            @if (User.IsInRole("Admin") || User.IsInRole("Librarian"))
            {
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary">Edit</a>
                <a asp-controller="Loans" asp-action="History" asp-route-id="@Model.Id"
                   class="btn btn-outline-secondary">Loan History</a>
            }
        </div>
    </div>
</div>
