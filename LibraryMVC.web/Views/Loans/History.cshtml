@model IList<Loan>
@{
    var book = (Book)ViewBag.Book;
    ViewData["Title"] = $"Loan History – {book.Title}";
}

<h2 class="mb-2">Loan History</h2>
<p class="text-muted mb-4">
    <strong>@book.Title</strong> by @book.Author
    — @book.AvailableCopies / @book.TotalCopies copies available
</p>

<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Borrower</th>
            <th>Borrowed</th>
            <th>Due</th>
            <th>Returned</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var loan in Model)
        {
            <tr>
                <td>@loan.BorrowedByUser?.Email</td>
                <td>@loan.BorrowedAt.ToString("dd MMM yyyy")</td>
                <td>@(loan.DueAt?.ToString("dd MMM yyyy") ?? "—")</td>
                <td>@(loan.ReturnedAt?.ToString("dd MMM yyyy") ?? "—")</td>
                <td>
                    <span class="badge @(loan.Status == LoanStatus.Borrowed ? "bg-warning text-dark" : "bg-success")">
                        @loan.Status
                    </span>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <div class="alert alert-info">No loans recorded for this book.</div>
}

<a asp-action="Index" class="btn btn-outline-secondary mt-3">← Back to Loans</a>